#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
DailyCheck Dashboard - Utilities & Test Data Generator
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ê–≤—Ç–æ—Ä: AI Assistant  
–í–µ—Ä—Å–∏—è: 4.0.0
–î–∞—Ç–∞: 2025-06-10
"""

import json
import random
import uuid
from datetime import datetime, date, timedelta
from pathlib import Path
from typing import Dict, List, Any
import argparse

# ===== –ì–ï–ù–ï–†–ê–¢–û–† –¢–ï–°–¢–û–í–´–• –î–ê–ù–ù–´–• =====

class TestDataGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞"""
    
    # –°–ø–∏—Å–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    FIRST_NAMES = [
        "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä", "–ú–∞—Ä–∏—è", "–°–µ—Ä–≥–µ–π", "–ê–Ω–Ω–∞", "–î–º–∏—Ç—Ä–∏–π", "–ï–ª–µ–Ω–∞", "–ú–∏—Ö–∞–∏–ª", "–û–ª—å–≥–∞",
        "–ê–Ω–¥—Ä–µ–π", "–ù–∞—Ç–∞–ª–∏—è", "–ê–ª–µ–∫—Å–µ–π", "–°–≤–µ—Ç–ª–∞–Ω–∞", "–í–ª–∞–¥–∏–º–∏—Ä", "–¢–∞—Ç—å—è–Ω–∞", "–ù–∏–∫–æ–ª–∞–π",
        "–ò—Ä–∏–Ω–∞", "–ü–∞–≤–µ–ª", "–Æ–ª–∏—è", "–ê—Ä—Ç–µ–º", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞", "–ú–∞–∫—Å–∏–º", "–í–∏–∫—Ç–æ—Ä–∏—è", "–†–æ–º–∞–Ω"
    ]
    
    USERNAMES = [
        "productivity_master", "habit_tracker", "goal_crusher", "daily_warrior", 
        "success_seeker", "motivation_hero", "task_ninja", "progress_maker",
        "efficiency_expert", "life_optimizer", "dream_chaser", "habit_builder"
    ]
    
    TASK_TITLES = {
        "health": [
            "–í—ã–ø–∏—Ç—å 8 —Å—Ç–∞–∫–∞–Ω–æ–≤ –≤–æ–¥—ã", "–°–¥–µ–ª–∞—Ç—å –∑–∞—Ä—è–¥–∫—É", "–ü—Ä–æ–π—Ç–∏ 10000 —à–∞–≥–æ–≤",
            "–ü—Ä–∏–Ω—è—Ç—å –≤–∏—Ç–∞–º–∏–Ω—ã", "–ú–µ–¥–∏—Ç–∏—Ä–æ–≤–∞—Ç—å 10 –º–∏–Ω—É—Ç", "–õ–µ—á—å —Å–ø–∞—Ç—å –¥–æ 23:00",
            "–°—ä–µ—Å—Ç—å 5 –ø–æ—Ä—Ü–∏–π –æ–≤–æ—â–µ–π", "–°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Ç—è–∂–∫—É", "–ü—Ä–æ–±–µ–∂–∞—Ç—å 30 –º–∏–Ω—É—Ç"
        ],
        "work": [
            "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á—Ç—É", "–í—ã–ø–æ–ª–Ω–∏—Ç—å –≥–ª–∞–≤–Ω—É—é –∑–∞–¥–∞—á—É", "–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
            "–ò–∑—É—á–∏—Ç—å –Ω–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª", "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ç—á–µ—Ç", "–ü—Ä–æ–≤–µ—Å—Ç–∏ –≤—Å—Ç—Ä–µ—á—É",
            "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç", "–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è", "–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ"
        ],
        "learning": [
            "–ü—Ä–æ—á–∏—Ç–∞—Ç—å 20 —Å—Ç—Ä–∞–Ω–∏—Ü", "–ò–∑—É—á–∏—Ç—å 10 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤", "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å TED –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ",
            "–†–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ", "–ò–∑—É—á–∏—Ç—å —É—Ä–æ–∫ –æ–Ω–ª–∞–π–Ω", "–ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç",
            "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª", "–°–¥–µ–ª–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è", "–ò–∑—É—á–∏—Ç—å –Ω–æ–≤—É—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é"
        ],
        "personal": [
            "–ù–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –¥–æ–º–∞", "–ü–æ–∑–≤–æ–Ω–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è–º", "–ó–∞–ø–∏—Å–∞—Ç—å –º—ã—Å–ª–∏ –≤ –¥–Ω–µ–≤–Ω–∏–∫",
            "–ü–æ—Å–ª—É—à–∞—Ç—å –º—É–∑—ã–∫—É", "–ü—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—É—é –µ–¥—É", "–ü—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è —Å —Å–µ–º—å–µ–π",
            "–ó–∞–Ω—è—Ç—å—Å—è —Ö–æ–±–±–∏", "–ü—Ä–æ–≥—É–ª—è—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ", "–í—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏"
        ],
        "finance": [
            "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã", "–û—Ç–ª–æ–∂–∏—Ç—å –¥–µ–Ω—å–≥–∏", "–ò–∑—É—á–∏—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏",
            "–û–ø–ª–∞—Ç–∏—Ç—å —Å—á–µ—Ç–∞", "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—é–¥–∂–µ—Ç", "–ü–æ—á–∏—Ç–∞—Ç—å –æ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö",
            "–û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω", "–°—Ä–∞–≤–Ω–∏—Ç—å —Ü–µ–Ω—ã", "–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã"
        ]
    }
    
    ACHIEVEMENTS = [
        "first_task", "streak_3", "streak_7", "tasks_10", "tasks_50", 
        "level_5", "social_butterfly", "early_bird", "perfect_week"
    ]
    
    @classmethod
    def generate_user(cls, user_id: int) -> Dict[str, Any]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""
        
        # –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        first_name = random.choice(cls.FIRST_NAMES)
        username = f"{random.choice(cls.USERNAMES)}_{random.randint(100, 999)}"
        
        # –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–æ—Ç 1 –¥–æ 365 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)
        days_ago = random.randint(1, 365)
        registration_date = (datetime.now() - timedelta(days=days_ago)).isoformat()
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        total_tasks = random.randint(5, 30)
        completed_tasks = random.randint(int(total_tasks * 0.3), int(total_tasks * 0.9))
        current_streak = random.randint(0, 50)
        longest_streak = max(current_streak, random.randint(0, 100))
        level = min(1 + completed_tasks // 10, 15)
        total_xp = completed_tasks * random.randint(15, 35) + level * 50
        
        # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user_data = {
            "user_id": user_id,
            "username": username,
            "first_name": first_name,
            "last_name": None,
            "settings": {
                "timezone": "UTC",
                "language": "ru", 
                "theme": random.choice(["classic", "dark", "nature", "minimal", "colorful"]),
                "daily_reminder_time": f"{random.randint(7, 10):02d}:00",
                "reminder_enabled": True,
                "weekly_stats": True,
                "motivational_messages": True,
                "notification_sound": True,
                "auto_archive_completed": False,
                "ai_chat_enabled": random.choice([True, False]),
                "show_xp": True,
                "show_streaks": True,
                "dry_mode_enabled": random.choice([True, False]),
                "pomodoro_duration": 25,
                "short_break_duration": 5,
                "long_break_duration": 15
            },
            "stats": {
                "total_tasks": total_tasks,
                "completed_tasks": completed_tasks,
                "current_streak": current_streak,
                "longest_streak": longest_streak,
                "total_xp": total_xp,
                "level": level,
                "last_activity": datetime.now().isoformat(),
                "registration_date": registration_date,
                "total_session_time": random.randint(3600, 86400),
                "preferred_time_of_day": random.choice(["morning", "afternoon", "evening"]),
                "tasks_completed_today": random.randint(0, 5),
                "daily_xp_earned": random.randint(0, 150),
                "weekly_goal": random.randint(5, 15),
                "monthly_goal": random.randint(20, 60),
                "dry_days": random.randint(0, 100) if user_data.get("settings", {}).get("dry_mode_enabled") else 0,
                "total_pomodoros": random.randint(0, 500)
            },
            "tasks": {},
            "achievements": random.sample(cls.ACHIEVEMENTS, random.randint(1, 5)),
            "friends": [],
            "reminders": [],
            "notes": f"–ó–∞–º–µ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {first_name}",
            "ai_chat_history": [],
            "weekly_goals": {}
        }
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–¥–∞—á–∏
        for i in range(total_tasks):
            task = cls.generate_task(user_id, i)
            user_data["tasks"][task["task_id"]] = task
        
        return user_data
    
    @classmethod 
    def generate_task(cls, user_id: int, task_index: int) -> Dict[str, Any]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏"""
        
        category = random.choice(list(cls.TASK_TITLES.keys()))
        title = random.choice(cls.TASK_TITLES[category])
        
        # –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (–æ—Ç 1 –¥–æ 90 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)
        days_ago = random.randint(1, 90)
        created_at = (datetime.now() - timedelta(days=days_ago)).isoformat()
        
        task = {
            "task_id": str(uuid.uuid4()),
            "user_id": user_id,
            "title": title,
            "description": f"–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏: {title.lower()}",
            "category": category,
            "priority": random.choice(["low", "medium", "high"]),
            "status": random.choice(["active"] * 8 + ["paused", "archived"]),  # 80% –∞–∫—Ç–∏–≤–Ω—ã—Ö
            "created_at": created_at,
            "completions": [],
            "subtasks": [],
            "tags": random.sample(["–≤–∞–∂–Ω–æ", "—Å—Ä–æ—á–Ω–æ", "–¥–æ–º", "—Ä–∞–±–æ—Ç–∞", "–∑–¥–æ—Ä–æ–≤—å–µ"], random.randint(0, 2)),
            "is_daily": True,
            "reminder_time": None,
            "estimated_time": random.choice([None, 15, 30, 45, 60]),
            "difficulty": random.randint(1, 5)
        }
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π
        task["completions"] = cls.generate_completions(days_ago)
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–¥–∑–∞–¥–∞—á–∏ (–∏–Ω–æ–≥–¥–∞)
        if random.random() < 0.3:  # 30% –∑–∞–¥–∞—á –∏–º–µ—é—Ç –ø–æ–¥–∑–∞–¥–∞—á–∏
            task["subtasks"] = cls.generate_subtasks(random.randint(1, 4))
        
        return task
    
    @classmethod
    def generate_completions(cls, days_since_creation: int) -> List[Dict[str, Any]]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –∑–∞–¥–∞—á–∏"""
        completions = []
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π
        completion_rate = random.uniform(0.3, 0.8)  # –û—Ç 30% –¥–æ 80% –¥–Ω–µ–π
        
        for i in range(days_since_creation):
            completion_date = (date.today() - timedelta(days=i)).isoformat()
            
            if random.random() < completion_rate:
                completion = {
                    "date": completion_date,
                    "completed": True,
                    "note": random.choice([None, "–í—ã–ø–æ–ª–Ω–µ–Ω–æ!", "–û—Ç–ª–∏—á–Ω–æ!", "–ë—ã–ª–æ —Å–ª–æ–∂–Ω–æ", "–õ–µ–≥–∫–æ"]),
                    "timestamp": (datetime.now() - timedelta(days=i, hours=random.randint(0, 23))).isoformat(),
                    "time_spent": random.choice([None, 15, 30, 45, 60])
                }
                completions.append(completion)
        
        return completions
    
    @classmethod
    def generate_subtasks(cls, count: int) -> List[Dict[str, Any]]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–∑–∞–¥–∞—á"""
        subtasks = []
        
        for i in range(count):
            subtask = {
                "subtask_id": str(uuid.uuid4()),
                "title": f"–ü–æ–¥–∑–∞–¥–∞—á–∞ {i + 1}",
                "completed": random.choice([True, False]),
                "created_at": datetime.now().isoformat()
            }
            subtasks.append(subtask)
        
        return subtasks

# ===== –£–¢–ò–õ–ò–¢–´ –î–ê–®–ë–û–†–î–ê =====

class DashboardUtils:
    """–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—à–±–æ—Ä–¥–æ–º"""
    
    @staticmethod
    def validate_data_file(file_path: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö"""
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                data = json.load(f)
            
            if not isinstance(data, dict):
                return False
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            for user_id, user_data in data.items():
                if not isinstance(user_data, dict):
                    return False
                
                required_fields = ["user_id", "settings", "stats", "tasks"]
                for field in required_fields:
                    if field not in user_data:
                        return False
            
            return True
            
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: {e}")
            return False
    
    @staticmethod
    def backup_data(source_file: str, backup_dir: str = "backups") -> str:
        """–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö"""
        backup_path = Path(backup_dir)
        backup_path.mkdir(exist_ok=True)
        
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_file = backup_path / f"backup_{timestamp}.json"
        
        import shutil
        shutil.copy2(source_file, backup_file)
        
        return str(backup_file)
    
    @staticmethod
    def clean_old_backups(backup_dir: str = "backups", keep_count: int = 10):
        """–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π"""
        backup_path = Path(backup_dir)
        
        if not backup_path.exists():
            return
        
        backups = list(backup_path.glob("backup_*.json"))
        backups.sort(key=lambda x: x.stat().st_mtime, reverse=True)
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã
        for backup in backups[keep_count:]:
            backup.unlink()
            print(f"–£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –±—ç–∫–∞–ø: {backup.name}")
    
    @staticmethod
    def optimize_data_file(file_path: str):
        """–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö"""
        with open(file_path, 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π (—Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞)
        cutoff_date = date.today() - timedelta(days=365)
        
        for user_data in data.values():
            for task in user_data.get("tasks", {}).values():
                completions = task.get("completions", [])
                filtered_completions = [
                    c for c in completions 
                    if date.fromisoformat(c["date"]) >= cutoff_date
                ]
                task["completions"] = filtered_completions
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        with open(file_path, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
        
        print(f"–î–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã: {file_path}")

# ===== CLI –ò–ù–¢–ï–†–§–ï–ô–° =====

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è CLI"""
    parser = argparse.ArgumentParser(description="DailyCheck Dashboard Utilities")
    
    subparsers = parser.add_subparsers(dest='command', help='–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã')
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    gen_parser = subparsers.add_parser('generate', help='–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö')
    gen_parser.add_argument('--users', type=int, default=10, help='–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')
    gen_parser.add_argument('--output', default='test_data.json', help='–§–∞–π–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è')
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    val_parser = subparsers.add_parser('validate', help='–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö')
    val_parser.add_argument('file', help='–§–∞–π–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏')
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
    backup_parser = subparsers.add_parser('backup', help='–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞')
    backup_parser.add_argument('file', help='–§–∞–π–ª –¥–ª—è –±—ç–∫–∞–ø–∞')
    backup_parser.add_argument('--dir', default='backups', help='–ü–∞–ø–∫–∞ –¥–ª—è –±—ç–∫–∞–ø–æ–≤')
    
    # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
    clean_parser = subparsers.add_parser('clean', help='–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤')
    clean_parser.add_argument('--dir', default='backups', help='–ü–∞–ø–∫–∞ —Å –±—ç–∫–∞–ø–∞–º–∏')
    clean_parser.add_argument('--keep', type=int, default=10, help='–°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–≤–∏—Ç—å')
    
    # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    opt_parser = subparsers.add_parser('optimize', help='–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö')
    opt_parser.add_argument('file', help='–§–∞–π–ª –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏')
    
    args = parser.parse_args()
    
    if args.command == 'generate':
        print(f"üé≤ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è {args.users} —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...")
        
        test_data = {}
        for i in range(args.users):
            user_id = 1000000 + i
            user_data = TestDataGenerator.generate_user(user_id)
            test_data[str(user_id)] = user_data
            print(f"   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id}: {user_data['first_name']}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
        with open(args.output, 'w', encoding='utf-8') as f:
            json.dump(test_data, f, ensure_ascii=False, indent=2)
        
        print(f"üíæ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: {args.output}")
        print(f"üìä –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(test_data)}")
        print(f"üìù –í—Å–µ–≥–æ –∑–∞–¥–∞—á: {sum(len(u['tasks']) for u in test_data.values())}")
        
    elif args.command == 'validate':
        print(f"üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞: {args.file}")
        
        if DashboardUtils.validate_data_file(args.file):
            print("‚úÖ –§–∞–π–ª –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω")
        else:
            print("‚ùå –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏")
    
    elif args.command == 'backup':
        print(f"üíæ –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞: {args.file}")
        
        backup_file = DashboardUtils.backup_data(args.file, args.dir)
        print(f"‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: {backup_file}")
    
    elif args.command == 'clean':
        print(f"üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ –≤ {args.dir}")
        
        DashboardUtils.clean_old_backups(args.dir, args.keep)
        print(f"‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω–æ {args.keep} –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤")
    
    elif args.command == 'optimize':
        print(f"‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–∞: {args.file}")
        
        # –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
        backup_file = DashboardUtils.backup_data(args.file)
        print(f"üíæ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: {backup_file}")
        
        DashboardUtils.optimize_data_file(args.file)
        print("‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
    
    else:
        parser.print_help()

if __name__ == "__main__":
    main()
